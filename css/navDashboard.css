#dashboard-container {
    /* keep the dashboard fixed to the viewport's bottom-right and offset it
       by the toggle hit width so the fixed toggle can sit flush against the screen. */
    position: fixed;
    bottom: 0px;
    right: calc(var(--nav-toggle-hit, 44px));
    z-index: 1000;
    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
}

:root { --nd-gap: 6px; --nav-toggle-w: 17px; --nav-toggle-hit: 44px; --dash-h: 16vh; }

.nav-dashboard {
    /* make the dashboard a single-row, four-column grid of perfect squares
       We compute a cell size from the dashboard height so width can be explicit.
       This lets width and height animate together smoothly when collapsing. */
    --cell-size: calc(var(--dash-h) - (2 * var(--nd-gap)));
    height: var(--dash-h); /* controlling size */
    /* total width = 4 * cell + 3 * gap + 2 * padding (padding == gap) => 4*cell + 5*gap */
    width: calc((var(--cell-size) * 4) + (var(--nd-gap) * 5));
    box-sizing: border-box;
    display: grid;
    grid-template-columns: repeat(4, auto);
    grid-auto-rows: 1fr; /* one row that fills available height */
    gap: var(--nd-gap);
    padding: var(--nd-gap);
    background: linear-gradient(180deg, #fbfbfb 0%, #d6d6d8 100%); /* off-white -> grey */
    border-radius: 8px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.18);
    border: 1px solid rgba(0,0,0,0.08);
    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    color: #111;
    overflow: hidden; /* ensure no scrollbars inside */
    position: relative;
    /* animate only horizontal transform so layout/height aren't affected */
    transition: transform 220ms cubic-bezier(.2,.8,.2,1);
    transform-origin: right center;
}

.nav-grid { display: contents; }

.nav-square {
    /* each square will size to the grid row height and become perfectly square because
       we set aspect-ratio: 1/1. Using height:100% makes the height match the grid row. */
    height: 100%;
    aspect-ratio: 1 / 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(180deg, #ffffff, #efefef);
    border-radius: 6px;
    border: 1px solid rgba(0,0,0,0.06);
    box-shadow: 0 6px 12px rgba(0,0,0,0.08);
    font-size: 0.95rem;
    box-sizing: border-box;
    overflow: hidden;
}

/* animate inner cells (smoother collapse) - only fade, do NOT scale/transform them
   removing transform prevents any perceived vertical shrinking during collapse */
.nav-grid > * {
    transition: opacity 220ms ease;
    will-change: opacity;
    position: relative;
    z-index: 1; /* keep inner cells beneath the toggle */
}


/* Toggle button */
.nav-toggle {
    /* place the toggle flush to the right edge of the viewport; actual touch width
       is larger than the visual chevron width to be touch-friendly */
    position: fixed;
    right: 0;
    bottom: 0px;
    width: var(--nav-toggle-hit); /* interactive hit width (touch-friendly) */
    height: var(--dash-h); /* visual height equals dashboard height */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px 0 0 6px; /* rounded on the left edge only */
    border: 1px solid rgba(0,0,0,0.08);
    background: rgba(255,255,255,0.98);
    box-shadow: 0 4px 8px rgba(0,0,0,0.12);
    cursor: pointer;
    font-size: 14px;
    z-index: 9999; /* ensure the toggle sits above the grid cells */
    /* don't animate height - keep height constant and change instantly; only rotate/transform the chevron */
    transition: transform 220ms ease;
    overflow: hidden;
    min-width: 44px; /* ensure a minimum touch target */
    padding-left: calc((var(--nav-toggle-hit) - var(--nav-toggle-w)) / 2);
    padding-right: calc((var(--nav-toggle-hit) - var(--nav-toggle-w)) / 2);
}

.nav-dashboard.collapsed {
    /* visual collapse handled by a horizontal scale transform; keep layout height unchanged
       until the element is hidden by JS after the transform finishes */
    transform: scaleX(var(--dash-scale, 0.12));
    pointer-events: none; /* content is hidden/faded while collapsed */
}

/* Don't hide children immediately; fade & scale them so width shrinks smoothly together with height */
.nav-dashboard.collapsed .nav-grid > * {
    opacity: 0;
    pointer-events: none;
}

/* no direct collapsed styles for the toggle here because it is outside the nav element */

/* chevron rotation: use sibling selector because the toggle lives outside the nav */
.nav-toggle svg { transition: transform 220ms ease; transform-origin: 50% 50%; }
#nav-dashboard + .nav-toggle svg { transform: rotate(0deg); }
#nav-dashboard.collapsed + .nav-toggle svg { transform: rotate(180deg); }

/* If the viewport is too narrow for the fixed vw/vh sizing, scale the dashboard down slightly */
@media (max-width: 420px), (max-height: 320px) {
    #dashboard-container { right: var(--nav-toggle-hit); bottom: 0px; }
    .nav-dashboard {
        height: -moz-fit-content;
        height: fit-content;
        width: calc(100vw - (var(--nav-toggle-hit)));
        padding: 4px;
        gap: 4px;
    }
    .nav-square { border-radius: 4px; }
    .nav-toggle {
        height: 88px; /* visual height equals dashboard height */
    }
}

/* On very small screens, keep the dashboard off to the side to avoid covering main content */
@media (max-width: 360px) {
    .nav-dashboard { display: none; }
}
